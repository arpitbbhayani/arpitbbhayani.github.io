<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" type="image/png" href="/static/images/icons/favicon.png">
    <link rel="icon" type="image/image/png" href="/static/images/icons/favicon.png">
    <link rel="icon" type="image/png" href="/static/images/icons/favicon.png" />

    <title>Making excerpts look good | Hi I'm Arpit ðŸ‘‹</title>
    <meta name="description" content="Excerpts are short snippet of a long text, that gives a rough idea of what the content is. They are generally first `n` characters from the text where the va...">
    <meta name="keywords" content="harry potter, potterverse, voldemort, search engine, elasticsearch, excerpts, text processing in python, " />

    <link rel="stylesheet" href="/static/css/semantic-2.min.css">
    <link rel="stylesheet" href="/static/css/pygments-2.css">
    <link rel="canonical" href="https://arpitbhayani.me/blog/making-excerpts-look-good.html">
    <link rel="alternate" type="application/rss+xml" title="Hi I'm Arpit ðŸ‘‹" href="https://arpitbhayani.me/feed.xml">

    <meta property="fb:app_id" content="1055615241238486" />

    <meta property="og:image" content="https://arpitbhayani.me/static/images/potterverse/potterverse-excerpts.png"/>
    <meta property="og:title" content="Making excerpts look good"/>
    <meta property="og:url" content="https://arpitbhayani.me/blog/making-excerpts-look-good.html"/>
    <meta property="og:site_name" content="Hi I'm Arpit ðŸ‘‹"/>
    <meta property="og:type" content="article"/>
    <meta property="og:description" content="Excerpts are short snippet of a long text, that gives a rough idea of what the content is. They are generally first `n` characters from the text where the va..." />

    <meta name="twitter:card" content="summary">
    <meta name="twitter:url" content="https://arpitbhayani.me/blog/making-excerpts-look-good.html">
    <meta name="twitter:title" content="Making excerpts look good">
    <meta name="twitter:description" content="Excerpts are short snippet of a long text, that gives a rough idea of what the content is. They are generally first `n` characters from the text where the va...">
    <meta name="twitter:image" content="https://arpitbhayani.me/static/images/potterverse/potterverse-excerpts.png">

    <script src="/static/js/jquery-1.11.3.min.js"></script>
</head>

    <body>
        <div class="ui secondary basic menu center aligned" style="border-top: 4px solid #0079ff; margin-bottom: 0px;">
    <a class="item" href="/">
        <div class="ui medium image">
            <img src="/static/images/profiles/arpit-logo.png">
        </div>
    </a>
    <a class=" item" href="/blogs.html">BLOGS</a>
    <!-- <a class=" item" href="/shredded-python.html">SHREDDED PYTHON</a> -->
    <a class=" item" href="/mrcup.html">MR CUP</a>
    <a class=" item" href="/talks.html">TALKS</a>
    <a class=" item" href="/projects.html">PROJECTS</a>
    <a class=" item" href="/vimarsh.html">VIMARSH</a>
    <a class=" item" href="/programming.html">PROGRAMMING</a>
    <a class=" item" href="/today-i-learned.html">TODAY I LEARNED</a>
    <a class="item" target="_blank" href="/static/arpit-bhayani-resume.pdf">RESUME</a>
</div>

        
            <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-71339255-1', 'auto');
  ga('send', 'pageview');

</script>

        
        <div class="ui text container" style="margin-top: 10px; padding-bottom: 50px;">
            <div class="ui hidden divider"></div>
<div itemscope="" itemtype="http://schema.org/BlogPosting">
    <article>
        <div class="ui basic segment" style="min-height:200px; background: #fff099;">
            <h1 itemprop="name headline" class="ui huge header center aligned" style="margin-top: 60px;">
                Making excerpts look good
            </h1>
        </div>
        <div class="ui text container">
            <div class="ui hidden divider"></div>
            <div class="ui large blue label">
                September 26, 2018
            </div>
            <div class="ui hidden divider"></div>
            <div itemprop="articleBody">
                <p>Excerpt is a short snippet of a long text, that gives a rough idea of what the content is.
They are generally first <code>n</code> characters from the text where the value of <code>n</code> totally depends
on the amount of information need to be shown to the user.</p>

<p>When someone searches on <a href="https://potterverse.arpitbhayani.me">Potterverse</a>, the search results
that are shown contains an excerpt of relevant page; reading which user gets an
idea of what the content of the page is and if he/she finds it interesting, then clicking on the item,
opens the source page in a new tab. The excerpt of information we show is the first <code>256</code> characters
of the page; which is sufficient to give a rough idea of what the page holds and it also takes
up 2-3 regular lines making the search result look beautiful.</p>

<p>Grass is looking lush green right now â€¦ so what could possibly go wrong by bluntly showing first <code>n</code>
characters? <img class="emoji" title=":poop:" alt=":poop:" src="/static/images/emoji/unicode/1f4a9.png" height="20" width="20"></p>

<h3 id="why-are-they-ugly">Why are they ugly?</h3>
<p>When we directly trim first <code>n</code> characters from the text, it will most probably end somewhere in the
middle of a word, which then abruptly ends the excerpt and in turn does not leave a very good impression
either. Here are some examples that elaborates this problem</p>

<div class="ui image">
    <img src="/static/images/potterverse/bad-1.jpg">
</div>

<div class="ui image">
    <img src="/static/images/potterverse/bad-2.jpg">
</div>

<p>The worst could be when the <code>n</code>th character ended at a very inappropriate place, like we see in the
example below</p>

<div class="ui image">
    <img src="/static/images/potterverse/bad-3.jpg">
</div>

<h3 id="making-them-look-good">Making them look good</h3>
<p>The excerpts we show right on <a href="https://potterverse.arpitbhayani.me">Potterverse</a> now are very
crisp and they look good <img class="emoji" title=":smile:" alt=":smile:" src="/static/images/emoji/unicode/1f604.png" height="20" width="20"> â€¦ wonder why?</p>

<p>We do the following:</p>

<ol>
  <li>Get string containing first <code>n</code> characters</li>
  <li>Trim trailing or leading whitespaces, if any</li>
  <li>Find the position of last whitespace, say <code>x</code>th</li>
  <li>Your neat excerpt is the substring from <code>0</code>th index to the <code>x-1</code>th</li>
  <li>Trim trailing whitespaces, so as to eliminate the case of consecutive spaces</li>
</ol>

<p>For example the string is</p>

<pre><code>quick brown fox jumps over the lazy dog
</code></pre>

<p>and we want excerpt of no more than <code>25</code> characters. heres what we do</p>

<ol>
  <li>Get the raw excerpt, <code>quick brown fox jumps ove</code>
</li>
  <li>Trim any white spaces, <code>quick brown fox jumps ove</code>
</li>
  <li>Right most whitespace position, <code>22</code>
</li>
  <li>Neat excerpt is substring from 0 to 22nd character, <code>quick brown fox jumps</code>
</li>
  <li>Trimming again leaves us with, <code>quick brown fox jumps</code>
</li>
</ol>

<p>Some example excerpts from Potterverse</p>

<div class="ui image">
    <img src="/static/images/potterverse/neat-1.jpg">
</div>

<div class="ui image">
    <img src="/static/images/potterverse/neat-2.jpg">
</div>

<div class="ui image">
    <img src="/static/images/potterverse/neat-3.jpg">
</div>

<p>Now donâ€™t they look good <img class="emoji" title=":heart_eyes:" alt=":heart_eyes:" src="/static/images/emoji/unicode/1f60d.png" height="20" width="20"></p>

<p>Apart from doing the above mentioned stuff, we also remove any character that matches the
regular expression <code>[^a-zA-Z0-9,'". ]</code>. Since we are only dealing with English data here,
this regular expression works just fine. When the Potterverse will also index data that
is non-english some modifications will surely be required here.</p>

<p>A basic python function that returns the neat excerpt</p>

<figure class="highlight"><pre><code class="language-py" data-lang="py"><span></span><span class="k">def</span> <span class="nf">get_neat_excerpt</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">text_length</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[:</span><span class="n">text_length</span><span class="p">]</span>
    <span class="n">excerpt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">'[^a-zA-Z0-9\,</span><span class="se">\'\"</span><span class="s1"> \.]'</span><span class="p">,</span> <span class="s1">' '</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">last_space</span> <span class="o">=</span> <span class="n">excerpt</span><span class="o">.</span><span class="n">rindex</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span>
        <span class="n">excerpt</span> <span class="o">=</span> <span class="n">excerpt</span><span class="p">[:</span><span class="n">last_space</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">excerpt</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">"."</span><span class="p">)</span></code></pre></figure>

<h3 id="conclusion">Conclusion</h3>
<p>Fixing the excerpt may not be a big problem to tackle but we do believe in giving
attention to the tiniest detail possible. Making excerpts look good not only
improved the user experience but it also did inculcate the importance of putting 
efforts in the stuff that seems trivial, at the first glance, but can be annoying
to the end user.</p>

            </div>
        </div>
    </article>
</div>

<div>
    <div class="ui hidden section divider"></div>
    <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7I42QE&amp;placement=arpitbhayanime" id="_carbonads_js"></script>

<style>
#carbonads {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu,
  Cantarell, "Helvetica Neue", Helvetica, Arial, sans-serif;
}

#carbonads {
  display: block;
  position: relative;
  overflow: hidden;
}

#carbonads > span {
  position: relative;
  display: block;
}

#carbonads a {
  color: inherit;
  text-decoration: none;
}

#carbonads a:hover {
  color: inherit;
}

.carbon-wrap {
  display: flex;
  align-items: center;

}

.carbon-img {
  display: block;
  margin: 0;
  line-height: 1;
}

.carbon-img img {
  display: block;
}

.carbon-text {
  display: flex;
  margin-bottom: 12px;
  position: relative;
  max-width: 500px;
  font-size: 16px;
  line-height: 1.4;
  padding: 8px 1em;
  text-align: left;
  align-items: center;
}

.carbon-text:after {
  display: table;
  content: 'Learn More';
  white-space: nowrap;
  margin-left: 20px;
  background-color: hsl(0, 0%, 20%);
  padding: 12px 16px;
  border-radius: 3px;
  line-height: 1;
  color: #fff;
  font-size: 14px;
  font-weight: 600;
}

.carbon-poweredby {
  position: absolute;
  bottom: 0;
  left: 146px;
  white-space: nowrap;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: .5px;
  font-weight: 500;
  color: #999 !important;
}
</style>
    <div class="ui hidden section divider"></div>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Banner -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9220578038638789" data-ad-slot="8551028114" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
    <div class="ui hidden section divider"></div>
</div>

<div class="ui text container">
    
        <div class="ui hidden divider"></div>
<div class="ui basic segment" style="background: #FFF">
    <div id="disqus_thread"></div>
</div>

<script>
/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

var disqus_config = function () {
this.page.url = "https://arpitbhayani.me/blog/making-excerpts-look-good.html";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = "/blog/making-excerpts-look-good.html"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//arpitbbhayani.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>

    
</div>
        </div>
        <footer style="background: #fff;">
    <div class="ui column centered grid">
        <div class="row">
            <div class="column center aligned">
                <div class="ui small icon borderless compact basic secondary menu">
    <div class="item">
        <a target="_blank" href="mailto:arpit.b.bhayani@gmail.com">
            <i class="mail outline large grey icon"></i>
        </a>
    </div>
    <div class="ui item">
        <a target="_blank" href="https://github.com/arpitbbhayani">
            <i class="github large grey icon"></i>
        </a>
    </div>
    <div class="ui item">
        <a target="_blank" href="https://facebook.com/oftenweird">
            <i class="facebook f large grey icon"></i>
        </a>
    </div>
    <div class="ui item">
        <a target="_blank" href="https://instagram.com/often_weird">
            <i class="instagram large grey icon"></i>
        </a>
    </div>
    <div class="ui item">
        <a target="_blank" href="https://twitter.com/arpit_bhayani">
            <i class="twitter large grey icon"></i>
        </a>
    </div>
</div>

            </div>
        </div>
        <div class="row">
            <div class="ui small grey text">Thanks for visiting!</div>
        </div>
    </div>
</footer>

    </body>
    
<head>
    <link href="https://fonts.googleapis.com/css?family=Comfortaa" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    
    <script src="/static/js/semantic-2.min.js"></script>
    <script src="/static/js/index.js"></script>
</head>

</html>
